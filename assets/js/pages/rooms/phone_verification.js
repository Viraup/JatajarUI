var cd,loginData={phone:null,password:null,otp:null};function addPhoneAjax(){var o={_token:$('#user_phone_num [name="_token"]').val(),phone:$('#user_phone_num [name="phone"]').val()};$("#user_phone_num .parent-loader").show(),$.ajax({url:APP_URL+"/add_phone_number",data:o,type:"POST",dataType:"json",success:function(n,e){0==n.validation?showNotification(n.msg,!0):n.duplicate?n.not_confirmed?(showNotification(n.msg),loginData.phone=o.phone,confirmOnFly()):showNotification(n.msg,!0):(showNotification(n.msg),verificationCode($('#user_phone_num [name="phone"]').val()))},error:function(n){showNotification(n.msg,!0)},complete:function(){$("#user_phone_num .parent-loader").hide()}})}function showNotification(n,e){iziToast.show({message:n,position:"topRight",color:e?"rgba(183, 28, 28, 0.98)":"rgba(28, 204, 35, 0.98)",messageColor:"#fff",rtl:"rtl"==$("html").attr("dir"),transitionIn:"bounceInLeft"})}function confirmCode(){$("#reset-pass-user-info").slideUp(),$("#reset-pass-confirm").slideDown(),$("#code_input").val(""),$("[data-err]").hide(),resetTimer()}function verifyAjax(n,e){n={phone_number:+n,otp:+e};$("#verify_panel .parent-loader").show(),$.post(APP_URL+"/user_phone_verification",n,function(n,e){"success"==e&&"success"==n.status?(showNotification(n.message),$(".alert").fadeIn(),$("[role='timer']").parent().fadeOut(),$("[role='resend-code']").fadeOut(),-1!=window.location.href.indexOf("/new")?$("#create_new_room").submit():-1!=window.location.href.indexOf("/edit")?$("#update_form").submit():-1!=window.location.href.indexOf("/rooms/")?$("#book_it_form").submit():window.location.reload()):($("#verify_panel .parent-loader").hide(),showNotification(n.message,!0))})}function confirmOnFly(){$.post(APP_URL+"/forgot_password_ajax",{phone_email:loginData.phone},function(n,e){"success"==e&&"success"==n.status&&verificationCode(loginData.phone)},"json")}function verificationCode(n){$("#phone_form").slideUp(),$("#verify_panel").slideDown(),$("#code-send-msg #numShow").html(n),resetTimer()}function countDown(e,o,i){clearInterval(cd),cd=setInterval(function(){var n=--e<10?"0"+e:e;o.text("00:"+n),0==e&&(clearInterval(cd),i())},1e3)}function resetTimer(){var n=$("#pnone_number_form").find("[role='timer']");$("#pnone_number_form").find("[role='resend-code']").hide(),n.parent().fadeIn(),$("#pnone_number_form").find("#otp-input").val(""),countDown(59,n,function(){$("#pnone_number_form").find("[role='resend-code']").fadeIn(),n.parent().hide()})}function digitsToEnglish(n){var e={"۰":"0","۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9"};return n.replace(/[۰-۹]/g,function(n){return e[n]})}$('[name="phone"]').on("change",function(){var n=$(this).val();$(this).val(digitsToEnglish(n))}),$("#add_phone_btn").click(function(n){n.preventDefault(),addPhoneAjax()}),$("#verify_panel #confirm").on("click",function(n){n.preventDefault();var n=+$('#user_phone_num [name="phone"]').val(),e=+$("#otp-input","#verify_panel").val();n&&(loginData.phone=n),e&&(loginData.otp=e),loginData.otp&&loginData.phone&&verifyAjax(loginData.phone,loginData.otp)}),$('[href="#editPhone"]').on("click",function(n){n.preventDefault(),$("#phone_form").slideDown(),$("#verify_panel").slideUp(),$(".parent-loader").hide()}),$("#resend-signup-code > a").on("click",function(n){n.preventDefault();n=+$('#user_phone_num [name="phone"]').val();$.post(APP_URL+"/verify_phone_number_sms",{phone_number:n},function(n,e){"success"==e&&"success"==n.status&&resetTimer()})});